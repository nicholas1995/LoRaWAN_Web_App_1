var cov_2i3m7lp0mf=function(){var path="/Users/nicholasmitchell/LoRaWAN_Web_App_1/server/src/controllers/gateway_profiles.js",hash="a0adeeb52961499a0f9f029f7e1796db15b21680",Function=function(){}.constructor,global=new Function('return this')(),gcv="__coverage__",coverageData={path:"/Users/nicholasmitchell/LoRaWAN_Web_App_1/server/src/controllers/gateway_profiles.js",statementMap:{"0":{start:{line:1,column:24},end:{line:1,column:66}},"1":{start:{line:2,column:27},end:{line:2,column:77}},"2":{start:{line:3,column:16},end:{line:3,column:46}},"3":{start:{line:4,column:14},end:{line:4,column:43}},"4":{start:{line:5,column:15},end:{line:5,column:32}},"5":{start:{line:9,column:4},end:{line:16,column:5}},"6":{start:{line:11,column:8},end:{line:15,column:10}},"7":{start:{line:35,column:4},end:{line:35,column:19}},"8":{start:{line:40,column:34},end:{line:40,column:36}},"9":{start:{line:41,column:26},end:{line:48,column:5}},"10":{start:{line:49,column:4},end:{line:65,column:5}},"11":{start:{line:50,column:8},end:{line:50,column:78}},"12":{start:{line:51,column:8},end:{line:51,column:73}},"13":{start:{line:52,column:8},end:{line:52,column:72}},"14":{start:{line:53,column:8},end:{line:53,column:80}},"15":{start:{line:54,column:8},end:{line:54,column:84}},"16":{start:{line:55,column:8},end:{line:55,column:78}},"17":{start:{line:56,column:8},end:{line:56,column:53}},"18":{start:{line:57,column:8},end:{line:64,column:10}},"19":{start:{line:66,column:4},end:{line:66,column:35}},"20":{start:{line:70,column:4},end:{line:82,column:5}},"21":{start:{line:71,column:8},end:{line:77,column:9}},"22":{start:{line:72,column:10},end:{line:76,column:11}},"23":{start:{line:73,column:14},end:{line:75,column:15}},"24":{start:{line:74,column:16},end:{line:74,column:105}},"25":{start:{line:78,column:8},end:{line:78,column:36}},"26":{start:{line:80,column:20},end:{line:80,column:49}},"27":{start:{line:81,column:8},end:{line:81,column:20}},"28":{start:{line:87,column:4},end:{line:114,column:5}},"29":{start:{line:88,column:27},end:{line:88,column:65}},"30":{start:{line:89,column:36},end:{line:94,column:14}},"31":{start:{line:92,column:28},end:{line:92,column:57}},"32":{start:{line:93,column:16},end:{line:93,column:28}},"33":{start:{line:95,column:8},end:{line:95,column:98}},"34":{start:{line:96,column:34},end:{line:101,column:14}},"35":{start:{line:99,column:28},end:{line:99,column:57}},"36":{start:{line:100,column:16},end:{line:100,column:28}},"37":{start:{line:102,column:8},end:{line:102,column:90}},"38":{start:{line:103,column:8},end:{line:108,column:14}},"39":{start:{line:106,column:28},end:{line:106,column:57}},"40":{start:{line:107,column:16},end:{line:107,column:28}},"41":{start:{line:109,column:8},end:{line:109,column:81}},"42":{start:{line:110,column:8},end:{line:110,column:37}},"43":{start:{line:112,column:8},end:{line:112,column:18}},"44":{start:{line:116,column:0},end:{line:132,column:1}},"45":{start:{line:119,column:8},end:{line:130,column:9}},"46":{start:{line:120,column:12},end:{line:124,column:19}},"47":{start:{line:123,column:20},end:{line:123,column:83}},"48":{start:{line:125,column:12},end:{line:125,column:74}},"49":{start:{line:126,column:12},end:{line:126,column:137}},"50":{start:{line:128,column:12},end:{line:128,column:29}},"51":{start:{line:129,column:12},end:{line:129,column:95}}},fnMap:{"0":{name:"gateway_profiles_request_data",decl:{start:{line:7,column:9},end:{line:7,column:38}},loc:{start:{line:7,column:51},end:{line:36,column:1}},line:7},"1":{name:"convert_names_gateway_profiles",decl:{start:{line:39,column:9},end:{line:39,column:39}},loc:{start:{line:39,column:58},end:{line:67,column:1}},line:39},"2":{name:"parse",decl:{start:{line:69,column:9},end:{line:69,column:14}},loc:{start:{line:69,column:57},end:{line:83,column:1}},line:69},"3":{name:"get_gateway_profiles",decl:{start:{line:85,column:15},end:{line:85,column:35}},loc:{start:{line:85,column:41},end:{line:115,column:1}},line:85},"4":{name:"(anonymous_4)",decl:{start:{line:90,column:19},end:{line:90,column:20}},loc:{start:{line:90,column:26},end:{line:94,column:13}},line:90},"5":{name:"(anonymous_5)",decl:{start:{line:97,column:19},end:{line:97,column:20}},loc:{start:{line:97,column:26},end:{line:101,column:13}},line:97},"6":{name:"(anonymous_6)",decl:{start:{line:104,column:19},end:{line:104,column:20}},loc:{start:{line:104,column:26},end:{line:108,column:13}},line:104},"7":{name:"(anonymous_7)",decl:{start:{line:117,column:9},end:{line:117,column:10}},loc:{start:{line:117,column:35},end:{line:131,column:5}},line:117},"8":{name:"(anonymous_8)",decl:{start:{line:121,column:23},end:{line:121,column:24}},loc:{start:{line:121,column:30},end:{line:124,column:17}},line:121}},branchMap:{"0":{loc:{start:{line:9,column:4},end:{line:16,column:5}},type:"if",locations:[{start:{line:9,column:4},end:{line:16,column:5}},{start:{line:9,column:4},end:{line:16,column:5}}],line:9},"1":{loc:{start:{line:73,column:14},end:{line:75,column:15}},type:"if",locations:[{start:{line:73,column:14},end:{line:75,column:15}},{start:{line:73,column:14},end:{line:75,column:15}}],line:73}},s:{"0":0,"1":0,"2":0,"3":0,"4":0,"5":0,"6":0,"7":0,"8":0,"9":0,"10":0,"11":0,"12":0,"13":0,"14":0,"15":0,"16":0,"17":0,"18":0,"19":0,"20":0,"21":0,"22":0,"23":0,"24":0,"25":0,"26":0,"27":0,"28":0,"29":0,"30":0,"31":0,"32":0,"33":0,"34":0,"35":0,"36":0,"37":0,"38":0,"39":0,"40":0,"41":0,"42":0,"43":0,"44":0,"45":0,"46":0,"47":0,"48":0,"49":0,"50":0,"51":0},f:{"0":0,"1":0,"2":0,"3":0,"4":0,"5":0,"6":0,"7":0,"8":0},b:{"0":[0,0],"1":[0,0]},_coverageSchema:"43e27e138ebf9cfc5966b082cf9a028302ed4184"},coverage=global[gcv]||(global[gcv]={});if(coverage[path]&&coverage[path].hash===hash){return coverage[path];}coverageData.hash=hash;return coverage[path]=coverageData;}();const lora_app_server=(cov_2i3m7lp0mf.s[0]++,require("../services/API/lora_app_server"));const db_gateway_profile=(cov_2i3m7lp0mf.s[1]++,require("../services/database/gateway_profile_db"));const compare=(cov_2i3m7lp0mf.s[2]++,require("../services/compare"));const error=(cov_2i3m7lp0mf.s[3]++,require("../services/errors"));const VError=(cov_2i3m7lp0mf.s[4]++,require("verror"));function gateway_profiles_request_data(data,type){cov_2i3m7lp0mf.f[0]++;let request;cov_2i3m7lp0mf.s[5]++;if(type==0){cov_2i3m7lp0mf.b[0][0]++;cov_2i3m7lp0mf.s[6]++;//get form
request={limit:100//offset: null,
//search: null
};}else{cov_2i3m7lp0mf.b[0][1]++;}/*  else if (type == 1) {
    //create form
    request = {
      organization: {
        canHaveGateways: data.can_have_gateways,
        displayName: `${data.display_name}`,
        name: `${data.network_name}`
      }
    };
  } else if (type == 2) {
    //Update form
    request = {
      organization: {
        canHaveGateways: data.can_have_gateways,
        displayName: `${data.display_name}`,
        name: `${data.network_name}`
      }
    };
  } */cov_2i3m7lp0mf.s[7]++;return request;}function convert_names_gateway_profiles(gateway_profiles){cov_2i3m7lp0mf.f[1]++;let gateway_profiles_return=(cov_2i3m7lp0mf.s[8]++,[]);let gateway_profile=(cov_2i3m7lp0mf.s[9]++,{created_at_time_stamp:null,gateway_profile_id_lora:null,gateway_profile_name:null,network_server_id:null,network_server_name:null,updated_at_time_stamp:null});cov_2i3m7lp0mf.s[10]++;for(let i=0;i<gateway_profiles.length;i++){cov_2i3m7lp0mf.s[11]++;gateway_profile.created_at_time_stamp=gateway_profiles[i].createdAt;cov_2i3m7lp0mf.s[12]++;gateway_profile.gateway_profile_id_lora=gateway_profiles[i].id;cov_2i3m7lp0mf.s[13]++;gateway_profile.gateway_profile_name=gateway_profiles[i].name;cov_2i3m7lp0mf.s[14]++;gateway_profile.network_server_id=gateway_profiles[i].networkServerID;cov_2i3m7lp0mf.s[15]++;gateway_profile.network_server_name=gateway_profiles[i].networkServerName;cov_2i3m7lp0mf.s[16]++;gateway_profile.updated_at_time_stamp=gateway_profiles[i].updatedAt;cov_2i3m7lp0mf.s[17]++;gateway_profiles_return[i]=gateway_profile;cov_2i3m7lp0mf.s[18]++;gateway_profile={created_at_time_stamp:null,gateway_profile_id_lora:null,gateway_profile_name:null,network_server_id:null,network_server_name:null,updated_at_time_stamp:null};}cov_2i3m7lp0mf.s[19]++;return gateway_profiles_return;}function parse(gateway_profile_lora,gateway_profile_db){cov_2i3m7lp0mf.f[2]++;cov_2i3m7lp0mf.s[20]++;try{cov_2i3m7lp0mf.s[21]++;for(let i=0;i<gateway_profile_lora.length;i++){cov_2i3m7lp0mf.s[22]++;for(let j=0;j<gateway_profile_db.length;j++){cov_2i3m7lp0mf.s[23]++;if(gateway_profile_lora[i].gateway_profile_id_lora==gateway_profile_db[j].gateway_profile_id_lora){cov_2i3m7lp0mf.b[1][0]++;cov_2i3m7lp0mf.s[24]++;gateway_profile_lora[i]["gateway_profile_id"]=gateway_profile_db[j].gateway_profile_id;}else{cov_2i3m7lp0mf.b[1][1]++;}}}cov_2i3m7lp0mf.s[25]++;return gateway_profile_lora;}catch(err){let error=(cov_2i3m7lp0mf.s[26]++,new VError("%s",err.message));cov_2i3m7lp0mf.s[27]++;throw error;}}async function get_gateway_profiles(req){cov_2i3m7lp0mf.f[3]++;cov_2i3m7lp0mf.s[28]++;//We fetch from the db twice because if after we compare one is added then we add it to the database and this new record will not be reflected
//in the current version of gateway_profiles_db
try{let request_body=(cov_2i3m7lp0mf.s[29]++,gateway_profiles_request_data(null,0));let gateway_profiles_lora=(cov_2i3m7lp0mf.s[30]++,await lora_app_server.get_gateway_profiles(request_body).catch(err=>{cov_2i3m7lp0mf.f[4]++;//Error getting gateway profiles from lora app server
let error=(cov_2i3m7lp0mf.s[31]++,new VError("%s",err.message));cov_2i3m7lp0mf.s[32]++;throw error;}));cov_2i3m7lp0mf.s[33]++;gateway_profiles_lora=convert_names_gateway_profiles(gateway_profiles_lora.data.result);let gateway_profiles_db=(cov_2i3m7lp0mf.s[34]++,await db_gateway_profile.get_gateway_profile().catch(err=>{cov_2i3m7lp0mf.f[5]++;//Error getting gateway profiles from database
let error=(cov_2i3m7lp0mf.s[35]++,new VError("%s",err.message));cov_2i3m7lp0mf.s[36]++;throw error;}));cov_2i3m7lp0mf.s[37]++;await compare.compare_gateway_profile(gateway_profiles_lora,gateway_profiles_db);cov_2i3m7lp0mf.s[38]++;gateway_profiles_db=await db_gateway_profile.get_gateway_profile().catch(err=>{cov_2i3m7lp0mf.f[6]++;//Error getting gateway profiles from database
let error=(cov_2i3m7lp0mf.s[39]++,new VError("%s",err.message));cov_2i3m7lp0mf.s[40]++;throw error;});cov_2i3m7lp0mf.s[41]++;gateway_profiles_lora=parse(gateway_profiles_lora,gateway_profiles_db);cov_2i3m7lp0mf.s[42]++;return gateway_profiles_lora;}catch(err){cov_2i3m7lp0mf.s[43]++;throw err;//Error getting gateway profiles from lora app server
}}cov_2i3m7lp0mf.s[44]++;module.exports={get:async function(req,res){cov_2i3m7lp0mf.f[7]++;let gateway_profiles_lora;cov_2i3m7lp0mf.s[45]++;try{cov_2i3m7lp0mf.s[46]++;gateway_profiles_lora=await get_gateway_profiles(req).catch(err=>{cov_2i3m7lp0mf.f[8]++;cov_2i3m7lp0mf.s[47]++;//Error getting gateway_profiles from lora app server
throw error.error_message("get gateway profiles",err.message);});cov_2i3m7lp0mf.s[48]++;gateway_profiles_lora=JSON.stringify(gateway_profiles_lora);cov_2i3m7lp0mf.s[49]++;res.status(200).send({gateway_profiles_lora:gateway_profiles_lora,message:'Gateway profiles fetched',type:'success'});}catch(err){cov_2i3m7lp0mf.s[50]++;console.log(err);cov_2i3m7lp0mf.s[51]++;res.status(500).send({message:"Failed to get gateway profiles",type:'error'});}}};