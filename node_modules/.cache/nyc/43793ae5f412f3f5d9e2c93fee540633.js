var cov_fm1fq3lmy=function(){var path="/Users/nicholasmitchell/LoRaWAN_Web_App_1/server/src/controllers/vessels.js",hash="bb54134069168f96b1a183c8ffd797e35b675757",Function=function(){}.constructor,global=new Function('return this')(),gcv="__coverage__",coverageData={path:"/Users/nicholasmitchell/LoRaWAN_Web_App_1/server/src/controllers/vessels.js",statementMap:{"0":{start:{line:1,column:11},end:{line:1,column:53}},"1":{start:{line:2,column:25},end:{line:2,column:73}},"2":{start:{line:3,column:23},end:{line:3,column:69}},"3":{start:{line:4,column:15},end:{line:4,column:32}},"4":{start:{line:5,column:25},end:{line:5,column:69}},"5":{start:{line:9,column:16},end:{line:9,column:76}},"6":{start:{line:10,column:4},end:{line:10,column:17}},"7":{start:{line:14,column:4},end:{line:30,column:5}},"8":{start:{line:15,column:22},end:{line:19,column:14}},"9":{start:{line:18,column:16},end:{line:18,column:75}},"10":{start:{line:20,column:12},end:{line:26,column:13}},"11":{start:{line:21,column:16},end:{line:25,column:23}},"12":{start:{line:24,column:24},end:{line:24,column:86}},"13":{start:{line:28,column:8},end:{line:28,column:24}},"14":{start:{line:29,column:8},end:{line:29,column:18}},"15":{start:{line:34,column:4},end:{line:48,column:5}},"16":{start:{line:35,column:29},end:{line:39,column:14}},"17":{start:{line:38,column:16},end:{line:38,column:98}},"18":{start:{line:40,column:8},end:{line:44,column:15}},"19":{start:{line:43,column:16},end:{line:43,column:97}},"20":{start:{line:45,column:8},end:{line:45,column:74}},"21":{start:{line:47,column:8},end:{line:47,column:18}},"22":{start:{line:51,column:0},end:{line:230,column:1}},"23":{start:{line:54,column:29},end:{line:54,column:33}},"24":{start:{line:55,column:8},end:{line:104,column:9}},"25":{start:{line:57,column:25},end:{line:57,column:30}},"26":{start:{line:58,column:12},end:{line:58,column:62}},"27":{start:{line:58,column:35},end:{line:58,column:62}},"28":{start:{line:59,column:12},end:{line:95,column:13}},"29":{start:{line:60,column:16},end:{line:87,column:17}},"30":{start:{line:61,column:20},end:{line:73,column:21}},"31":{start:{line:63,column:24},end:{line:66,column:31}},"32":{start:{line:65,column:32},end:{line:65,column:42}},"33":{start:{line:69,column:24},end:{line:72,column:31}},"34":{start:{line:71,column:32},end:{line:71,column:42}},"35":{start:{line:74,column:23},end:{line:87,column:17}},"36":{start:{line:76,column:20},end:{line:79,column:27}},"37":{start:{line:78,column:28},end:{line:78,column:38}},"38":{start:{line:83,column:20},end:{line:86,column:27}},"39":{start:{line:85,column:28},end:{line:85,column:38}},"40":{start:{line:89,column:17},end:{line:95,column:13}},"41":{start:{line:90,column:16},end:{line:94,column:23}},"42":{start:{line:93,column:24},end:{line:93,column:34}},"43":{start:{line:96,column:12},end:{line:96,column:105}},"44":{start:{line:98,column:12},end:{line:98,column:29}},"45":{start:{line:99,column:12},end:{line:103,column:13}},"46":{start:{line:100,column:16},end:{line:100,column:103}},"47":{start:{line:102,column:16},end:{line:102,column:112}},"48":{start:{line:107,column:8},end:{line:111,column:9}},"49":{start:{line:108,column:12},end:{line:108,column:97}},"50":{start:{line:110,column:12},end:{line:110,column:28}},"51":{start:{line:114,column:29},end:{line:114,column:33}},"52":{start:{line:115,column:8},end:{line:134,column:9}},"53":{start:{line:116,column:23},end:{line:116,column:38}},"54":{start:{line:117,column:12},end:{line:122,column:15}},"55":{start:{line:120,column:16},end:{line:120,column:35}},"56":{start:{line:121,column:16},end:{line:121,column:76}},"57":{start:{line:124,column:12},end:{line:124,column:81}},"58":{start:{line:128,column:12},end:{line:128,column:29}},"59":{start:{line:129,column:12},end:{line:133,column:13}},"60":{start:{line:130,column:16},end:{line:130,column:89}},"61":{start:{line:132,column:16},end:{line:132,column:73}},"62":{start:{line:137,column:29},end:{line:137,column:33}},"63":{start:{line:138,column:8},end:{line:157,column:9}},"64":{start:{line:139,column:23},end:{line:139,column:38}},"65":{start:{line:140,column:12},end:{line:145,column:19}},"66":{start:{line:143,column:20},end:{line:143,column:39}},"67":{start:{line:144,column:20},end:{line:144,column:81}},"68":{start:{line:147,column:12},end:{line:147,column:81}},"69":{start:{line:151,column:12},end:{line:151,column:29}},"70":{start:{line:152,column:12},end:{line:156,column:13}},"71":{start:{line:153,column:16},end:{line:153,column:92}},"72":{start:{line:155,column:16},end:{line:155,column:73}},"73":{start:{line:160,column:29},end:{line:160,column:33}},"74":{start:{line:162,column:8},end:{line:204,column:9}},"75":{start:{line:163,column:12},end:{line:168,column:19}},"76":{start:{line:166,column:20},end:{line:166,column:39}},"77":{start:{line:167,column:20},end:{line:167,column:81}},"78":{start:{line:169,column:12},end:{line:173,column:19}},"79":{start:{line:172,column:20},end:{line:172,column:72}},"80":{start:{line:175,column:12},end:{line:180,column:19}},"81":{start:{line:178,column:20},end:{line:178,column:39}},"82":{start:{line:179,column:20},end:{line:179,column:122}},"83":{start:{line:182,column:12},end:{line:187,column:19}},"84":{start:{line:185,column:20},end:{line:185,column:39}},"85":{start:{line:186,column:20},end:{line:186,column:80}},"86":{start:{line:188,column:12},end:{line:188,column:105}},"87":{start:{line:194,column:12},end:{line:194,column:29}},"88":{start:{line:195,column:12},end:{line:203,column:13}},"89":{start:{line:196,column:16},end:{line:196,column:92}},"90":{start:{line:197,column:19},end:{line:203,column:13}},"91":{start:{line:198,column:16},end:{line:198,column:138}},"92":{start:{line:199,column:19},end:{line:203,column:13}},"93":{start:{line:200,column:16},end:{line:200,column:106}},"94":{start:{line:202,column:16},end:{line:202,column:73}},"95":{start:{line:207,column:8},end:{line:228,column:9}},"96":{start:{line:208,column:26},end:{line:212,column:18}},"97":{start:{line:211,column:20},end:{line:211,column:107}},"98":{start:{line:213,column:12},end:{line:224,column:13}},"99":{start:{line:214,column:16},end:{line:218,column:22}},"100":{start:{line:217,column:24},end:{line:217,column:104}},"101":{start:{line:219,column:16},end:{line:223,column:23}},"102":{start:{line:222,column:24},end:{line:222,column:69}},"103":{start:{line:226,column:12},end:{line:226,column:28}},"104":{start:{line:227,column:12},end:{line:227,column:22}}},fnMap:{"0":{name:"error_message",decl:{start:{line:8,column:9},end:{line:8,column:22}},loc:{start:{line:8,column:61},end:{line:11,column:1}},line:8},"1":{name:"add_device_to_default_vessel_when_vessel_deleted",decl:{start:{line:13,column:15},end:{line:13,column:63}},loc:{start:{line:13,column:74},end:{line:31,column:1}},line:13},"2":{name:"(anonymous_2)",decl:{start:{line:16,column:19},end:{line:16,column:20}},loc:{start:{line:16,column:26},end:{line:19,column:13}},line:16},"3":{name:"(anonymous_3)",decl:{start:{line:22,column:27},end:{line:22,column:28}},loc:{start:{line:22,column:34},end:{line:25,column:21}},line:22},"4":{name:"add_device_to_default_vessel",decl:{start:{line:33,column:15},end:{line:33,column:43}},loc:{start:{line:33,column:83},end:{line:49,column:1}},line:33},"5":{name:"(anonymous_5)",decl:{start:{line:36,column:19},end:{line:36,column:20}},loc:{start:{line:36,column:26},end:{line:39,column:13}},line:36},"6":{name:"(anonymous_6)",decl:{start:{line:41,column:19},end:{line:41,column:20}},loc:{start:{line:41,column:26},end:{line:44,column:13}},line:41},"7":{name:"(anonymous_7)",decl:{start:{line:52,column:9},end:{line:52,column:10}},loc:{start:{line:52,column:34},end:{line:105,column:5}},line:52},"8":{name:"(anonymous_8)",decl:{start:{line:64,column:35},end:{line:64,column:36}},loc:{start:{line:64,column:42},end:{line:66,column:29}},line:64},"9":{name:"(anonymous_9)",decl:{start:{line:70,column:35},end:{line:70,column:36}},loc:{start:{line:70,column:42},end:{line:72,column:29}},line:70},"10":{name:"(anonymous_10)",decl:{start:{line:77,column:31},end:{line:77,column:32}},loc:{start:{line:77,column:38},end:{line:79,column:25}},line:77},"11":{name:"(anonymous_11)",decl:{start:{line:84,column:31},end:{line:84,column:32}},loc:{start:{line:84,column:38},end:{line:86,column:25}},line:84},"12":{name:"(anonymous_12)",decl:{start:{line:91,column:27},end:{line:91,column:28}},loc:{start:{line:91,column:34},end:{line:94,column:21}},line:91},"13":{name:"(anonymous_13)",decl:{start:{line:106,column:13},end:{line:106,column:14}},loc:{start:{line:106,column:37},end:{line:112,column:5}},line:106},"14":{name:"(anonymous_14)",decl:{start:{line:113,column:12},end:{line:113,column:13}},loc:{start:{line:113,column:36},end:{line:135,column:5}},line:113},"15":{name:"(anonymous_15)",decl:{start:{line:118,column:19},end:{line:118,column:20}},loc:{start:{line:118,column:26},end:{line:122,column:13}},line:118},"16":{name:"(anonymous_16)",decl:{start:{line:136,column:12},end:{line:136,column:13}},loc:{start:{line:136,column:36},end:{line:158,column:5}},line:136},"17":{name:"(anonymous_17)",decl:{start:{line:141,column:23},end:{line:141,column:24}},loc:{start:{line:141,column:30},end:{line:145,column:17}},line:141},"18":{name:"(anonymous_18)",decl:{start:{line:159,column:12},end:{line:159,column:13}},loc:{start:{line:159,column:36},end:{line:205,column:5}},line:159},"19":{name:"(anonymous_19)",decl:{start:{line:164,column:23},end:{line:164,column:24}},loc:{start:{line:164,column:30},end:{line:168,column:17}},line:164},"20":{name:"(anonymous_20)",decl:{start:{line:170,column:23},end:{line:170,column:24}},loc:{start:{line:170,column:30},end:{line:173,column:17}},line:170},"21":{name:"(anonymous_21)",decl:{start:{line:176,column:23},end:{line:176,column:24}},loc:{start:{line:176,column:30},end:{line:180,column:17}},line:176},"22":{name:"(anonymous_22)",decl:{start:{line:183,column:23},end:{line:183,column:24}},loc:{start:{line:183,column:30},end:{line:187,column:17}},line:183},"23":{name:"(anonymous_23)",decl:{start:{line:206,column:40},end:{line:206,column:41}},loc:{start:{line:206,column:70},end:{line:229,column:5}},line:206},"24":{name:"(anonymous_24)",decl:{start:{line:209,column:23},end:{line:209,column:24}},loc:{start:{line:209,column:30},end:{line:212,column:17}},line:209},"25":{name:"(anonymous_25)",decl:{start:{line:215,column:27},end:{line:215,column:28}},loc:{start:{line:215,column:34},end:{line:218,column:21}},line:215},"26":{name:"(anonymous_26)",decl:{start:{line:220,column:27},end:{line:220,column:28}},loc:{start:{line:220,column:34},end:{line:223,column:21}},line:220}},branchMap:{"0":{loc:{start:{line:58,column:12},end:{line:58,column:62}},type:"if",locations:[{start:{line:58,column:12},end:{line:58,column:62}},{start:{line:58,column:12},end:{line:58,column:62}}],line:58},"1":{loc:{start:{line:59,column:12},end:{line:95,column:13}},type:"if",locations:[{start:{line:59,column:12},end:{line:95,column:13}},{start:{line:59,column:12},end:{line:95,column:13}}],line:59},"2":{loc:{start:{line:59,column:16},end:{line:59,column:55}},type:"binary-expr",locations:[{start:{line:59,column:16},end:{line:59,column:35}},{start:{line:59,column:39},end:{line:59,column:55}}],line:59},"3":{loc:{start:{line:60,column:16},end:{line:87,column:17}},type:"if",locations:[{start:{line:60,column:16},end:{line:87,column:17}},{start:{line:60,column:16},end:{line:87,column:17}}],line:60},"4":{loc:{start:{line:61,column:20},end:{line:73,column:21}},type:"if",locations:[{start:{line:61,column:20},end:{line:73,column:21}},{start:{line:61,column:20},end:{line:73,column:21}}],line:61},"5":{loc:{start:{line:74,column:23},end:{line:87,column:17}},type:"if",locations:[{start:{line:74,column:23},end:{line:87,column:17}},{start:{line:74,column:23},end:{line:87,column:17}}],line:74},"6":{loc:{start:{line:89,column:17},end:{line:95,column:13}},type:"if",locations:[{start:{line:89,column:17},end:{line:95,column:13}},{start:{line:89,column:17},end:{line:95,column:13}}],line:89},"7":{loc:{start:{line:89,column:20},end:{line:89,column:60}},type:"binary-expr",locations:[{start:{line:89,column:20},end:{line:89,column:40}},{start:{line:89,column:44},end:{line:89,column:60}}],line:89},"8":{loc:{start:{line:99,column:12},end:{line:103,column:13}},type:"if",locations:[{start:{line:99,column:12},end:{line:103,column:13}},{start:{line:99,column:12},end:{line:103,column:13}}],line:99},"9":{loc:{start:{line:129,column:12},end:{line:133,column:13}},type:"if",locations:[{start:{line:129,column:12},end:{line:133,column:13}},{start:{line:129,column:12},end:{line:133,column:13}}],line:129},"10":{loc:{start:{line:152,column:12},end:{line:156,column:13}},type:"if",locations:[{start:{line:152,column:12},end:{line:156,column:13}},{start:{line:152,column:12},end:{line:156,column:13}}],line:152},"11":{loc:{start:{line:195,column:12},end:{line:203,column:13}},type:"if",locations:[{start:{line:195,column:12},end:{line:203,column:13}},{start:{line:195,column:12},end:{line:203,column:13}}],line:195},"12":{loc:{start:{line:197,column:19},end:{line:203,column:13}},type:"if",locations:[{start:{line:197,column:19},end:{line:203,column:13}},{start:{line:197,column:19},end:{line:203,column:13}}],line:197},"13":{loc:{start:{line:199,column:19},end:{line:203,column:13}},type:"if",locations:[{start:{line:199,column:19},end:{line:203,column:13}},{start:{line:199,column:19},end:{line:203,column:13}}],line:199}},s:{"0":0,"1":0,"2":0,"3":0,"4":0,"5":0,"6":0,"7":0,"8":0,"9":0,"10":0,"11":0,"12":0,"13":0,"14":0,"15":0,"16":0,"17":0,"18":0,"19":0,"20":0,"21":0,"22":0,"23":0,"24":0,"25":0,"26":0,"27":0,"28":0,"29":0,"30":0,"31":0,"32":0,"33":0,"34":0,"35":0,"36":0,"37":0,"38":0,"39":0,"40":0,"41":0,"42":0,"43":0,"44":0,"45":0,"46":0,"47":0,"48":0,"49":0,"50":0,"51":0,"52":0,"53":0,"54":0,"55":0,"56":0,"57":0,"58":0,"59":0,"60":0,"61":0,"62":0,"63":0,"64":0,"65":0,"66":0,"67":0,"68":0,"69":0,"70":0,"71":0,"72":0,"73":0,"74":0,"75":0,"76":0,"77":0,"78":0,"79":0,"80":0,"81":0,"82":0,"83":0,"84":0,"85":0,"86":0,"87":0,"88":0,"89":0,"90":0,"91":0,"92":0,"93":0,"94":0,"95":0,"96":0,"97":0,"98":0,"99":0,"100":0,"101":0,"102":0,"103":0,"104":0},f:{"0":0,"1":0,"2":0,"3":0,"4":0,"5":0,"6":0,"7":0,"8":0,"9":0,"10":0,"11":0,"12":0,"13":0,"14":0,"15":0,"16":0,"17":0,"18":0,"19":0,"20":0,"21":0,"22":0,"23":0,"24":0,"25":0,"26":0},b:{"0":[0,0],"1":[0,0],"2":[0,0],"3":[0,0],"4":[0,0],"5":[0,0],"6":[0,0],"7":[0,0],"8":[0,0],"9":[0,0],"10":[0,0],"11":[0,0],"12":[0,0],"13":[0,0]},_coverageSchema:"43e27e138ebf9cfc5966b082cf9a028302ed4184"},coverage=global[gcv]||(global[gcv]={});if(coverage[path]&&coverage[path].hash===hash){return coverage[path];}coverageData.hash=hash;return coverage[path]=coverageData;}();const DB=(cov_fm1fq3lmy.s[0]++,require('../services/database/vessels_db'));const DB_VESSEL_DEVICE=(cov_fm1fq3lmy.s[1]++,require("../services/database/vessel_device_db"));const DB_USER_VESSEL=(cov_fm1fq3lmy.s[2]++,require("../services/database/user_vessel_db"));const VError=(cov_fm1fq3lmy.s[3]++,require('verror'));const DEVICE_UPLINK_DB=(cov_fm1fq3lmy.s[4]++,require('../services/database/device_rx_db'));function error_message(current_error_message,previous_error){cov_fm1fq3lmy.f[0]++;let error=(cov_fm1fq3lmy.s[5]++,new VError("%s : %s",current_error_message,previous_error));cov_fm1fq3lmy.s[6]++;return error;}async function add_device_to_default_vessel_when_vessel_deleted(vessel_id){cov_fm1fq3lmy.f[1]++;cov_fm1fq3lmy.s[7]++;try{let devices=(cov_fm1fq3lmy.s[8]++,await DB_VESSEL_DEVICE.get_not_deleted_given_vessel_id(vessel_id).catch(err=>{cov_fm1fq3lmy.f[2]++;cov_fm1fq3lmy.s[9]++;//Error fetching the devices from the vessel to be deleted from the vessel device table
throw error_message("get devices : database",err.message);}));cov_fm1fq3lmy.s[10]++;for(let i=0;i<devices.length;i++){cov_fm1fq3lmy.s[11]++;await add_device_to_default_vessel(devices[i].device_id,devices[i].device_eui,devices[i].sub_network_id).catch(err=>{cov_fm1fq3lmy.f[3]++;cov_fm1fq3lmy.s[12]++;//Error adding device to the default vessel of a given subnetwork
throw error_message("reassing device to vessel",err.message);});}}catch(err){cov_fm1fq3lmy.s[13]++;console.log(err);cov_fm1fq3lmy.s[14]++;throw err;}}async function add_device_to_default_vessel(device_id,device_eui,sub_network_id){cov_fm1fq3lmy.f[4]++;cov_fm1fq3lmy.s[15]++;try{let default_vessel=(cov_fm1fq3lmy.s[16]++,await DB.get_default_vessel_specified_sub_network(sub_network_id).catch(err=>{cov_fm1fq3lmy.f[5]++;cov_fm1fq3lmy.s[17]++;//Error fetching the default vessel for a given sub_network
throw error_message("get default vessel for sub-network : database",err.message);}));cov_fm1fq3lmy.s[18]++;await DB_VESSEL_DEVICE.create(device_id,device_eui,default_vessel[0].vessel_id).catch(err=>{cov_fm1fq3lmy.f[6]++;cov_fm1fq3lmy.s[19]++;//Error creating vessel device relationship 
throw error_message("create vessel device relationship : database",err.message);});cov_fm1fq3lmy.s[20]++;console.log("Device vessel relationship created. Default vessel");}catch(err){cov_fm1fq3lmy.s[21]++;throw err;}}cov_fm1fq3lmy.s[22]++;module.exports={get:async function(req,res){cov_fm1fq3lmy.f[7]++;//need to split up into two seperate fetches. One for self and another for all 
let error_location=(cov_fm1fq3lmy.s[23]++,null);//1=db
cov_fm1fq3lmy.s[24]++;try{let vessels_db;let access=(cov_fm1fq3lmy.s[25]++,'all');cov_fm1fq3lmy.s[26]++;if(req.params.access){cov_fm1fq3lmy.b[0][0]++;cov_fm1fq3lmy.s[27]++;access=req.params.access;}else{cov_fm1fq3lmy.b[0][1]++;}//This is used to only set access to self if it is specified in the url... If not it is default to all and we rely on the access that is specified in the token
cov_fm1fq3lmy.s[28]++;if((cov_fm1fq3lmy.b[2][0]++,req.access=="all")&&(cov_fm1fq3lmy.b[2][1]++,access!='self')){cov_fm1fq3lmy.b[1][0]++;cov_fm1fq3lmy.s[29]++;if(req.params.sub_network_id){cov_fm1fq3lmy.b[3][0]++;cov_fm1fq3lmy.s[30]++;if(req.params.deleted){cov_fm1fq3lmy.b[4][0]++;cov_fm1fq3lmy.s[31]++;//Sub-Network and Deleted specified
vessels_db=await DB.get_vessels(null,null,req.params.deleted,req.params.sub_network_id).catch(err=>{cov_fm1fq3lmy.f[8]++;cov_fm1fq3lmy.s[32]++;throw err;});}else{cov_fm1fq3lmy.b[4][1]++;cov_fm1fq3lmy.s[33]++;//Sub network specified
vessels_db=await DB.get_vessels(null,null,null,req.params.sub_network_id).catch(err=>{cov_fm1fq3lmy.f[9]++;cov_fm1fq3lmy.s[34]++;throw err;});}}else{cov_fm1fq3lmy.b[3][1]++;cov_fm1fq3lmy.s[35]++;if(req.params.deleted){cov_fm1fq3lmy.b[5][0]++;cov_fm1fq3lmy.s[36]++;//Deleted Specified
vessels_db=await DB.get_vessels(null,null,req.params.deleted,null).catch(err=>{cov_fm1fq3lmy.f[10]++;cov_fm1fq3lmy.s[37]++;throw err;});}else{cov_fm1fq3lmy.b[5][1]++;cov_fm1fq3lmy.s[38]++;//None Specified
vessels_db=await DB.get_vessels(null,null,null,null).catch(err=>{cov_fm1fq3lmy.f[11]++;cov_fm1fq3lmy.s[39]++;throw err;});}}}else{cov_fm1fq3lmy.b[1][1]++;cov_fm1fq3lmy.s[40]++;if((cov_fm1fq3lmy.b[7][0]++,req.access=='self')||(cov_fm1fq3lmy.b[7][1]++,access=='self')){cov_fm1fq3lmy.b[6][0]++;cov_fm1fq3lmy.s[41]++;vessels_db=await DB_USER_VESSEL.get_user_vessel(null,req.user.id,null,null).catch(err=>{cov_fm1fq3lmy.f[12]++;cov_fm1fq3lmy.s[42]++;//Error fetching vessels for user
throw err;});}else{cov_fm1fq3lmy.b[6][1]++;}}cov_fm1fq3lmy.s[43]++;res.status(200).send({vessels_db:vessels_db,message:'Vessels fetched',type:'success'});}catch(err){cov_fm1fq3lmy.s[44]++;console.log(err);cov_fm1fq3lmy.s[45]++;if(error_location==1){cov_fm1fq3lmy.b[8][0]++;cov_fm1fq3lmy.s[46]++;res.status(500).send({message:"Error fetching vessels from database",type:'error'});}else{cov_fm1fq3lmy.b[8][1]++;cov_fm1fq3lmy.s[47]++;res.status(500).send({message:'Failed to get vessels : error in get function',type:'error'});}}},get_all:async function(req,res){cov_fm1fq3lmy.f[13]++;cov_fm1fq3lmy.s[48]++;try{cov_fm1fq3lmy.s[49]++;res.status(501).send({message:'Not Implemented: Vessels get all',type:'error'});}catch(err){cov_fm1fq3lmy.s[50]++;console.log(err);}},create:async function(req,res){cov_fm1fq3lmy.f[14]++;let error_location=(cov_fm1fq3lmy.s[51]++,null);cov_fm1fq3lmy.s[52]++;try{let data=(cov_fm1fq3lmy.s[53]++,req.body.vessel);cov_fm1fq3lmy.s[54]++;await DB.create_vessels(data.vessel_name,data.vessel_unique_vessel_identifier,data.vessel_international_radio_call_sign,data.vessel_type,data.sub_network_id).catch(err=>{cov_fm1fq3lmy.f[15]++;cov_fm1fq3lmy.s[55]++;//error creating vessel on db
error_location=0;cov_fm1fq3lmy.s[56]++;throw error_message("create vessel : database",err.message);});//console.log("Vessel created");
cov_fm1fq3lmy.s[57]++;res.status(201).send({message:'Vessel created',type:'success'});}catch(err){cov_fm1fq3lmy.s[58]++;//e_l =0 (problem creating vessel)
//other = (unknown error/exception)
console.log(err);cov_fm1fq3lmy.s[59]++;if(error_location==0){cov_fm1fq3lmy.b[9][0]++;cov_fm1fq3lmy.s[60]++;res.status(500).send({message:"Error creating vessel.",type:'info'});}else{cov_fm1fq3lmy.b[9][1]++;cov_fm1fq3lmy.s[61]++;res.status(500).send({message:'Error',type:'error'});}}},update:async function(req,res){cov_fm1fq3lmy.f[16]++;let error_location=(cov_fm1fq3lmy.s[62]++,null);cov_fm1fq3lmy.s[63]++;try{let data=(cov_fm1fq3lmy.s[64]++,req.body.vessel);cov_fm1fq3lmy.s[65]++;await DB.update_vessels_all_parameters(data,req.params.vessel_id).catch(err=>{cov_fm1fq3lmy.f[17]++;cov_fm1fq3lmy.s[66]++;//error updating vessel on db
error_location=0;cov_fm1fq3lmy.s[67]++;throw error_message("update vessel : database",err.message);});//console.log("Vessel Updated. Vessel ID: " + req.params.vessel_id);
cov_fm1fq3lmy.s[68]++;res.status(201).send({message:'Vessel updated',type:'success'});}catch(err){cov_fm1fq3lmy.s[69]++;//e_l =0 (problem updating vessel)
//other = (unknown error/exception)
console.log(err);cov_fm1fq3lmy.s[70]++;if(error_location==0){cov_fm1fq3lmy.b[10][0]++;cov_fm1fq3lmy.s[71]++;res.status(500).send({message:"Failed to update vessel",type:'error'});}else{cov_fm1fq3lmy.b[10][1]++;cov_fm1fq3lmy.s[72]++;res.status(500).send({message:'Error',type:'error'});}}},delete:async function(req,res){cov_fm1fq3lmy.f[18]++;let error_location=(cov_fm1fq3lmy.s[73]++,null);//0=lora, 1=lora 2=db
let vessels_db;cov_fm1fq3lmy.s[74]++;try{cov_fm1fq3lmy.s[75]++;await DB.update_vessels("vessel_deleted",1,req.params.vessel_id).catch(err=>{cov_fm1fq3lmy.f[19]++;cov_fm1fq3lmy.s[76]++;//error updating delete coloum from DB for vessel
error_location=0;cov_fm1fq3lmy.s[77]++;throw error_message("delete vessel : database",err.message);});cov_fm1fq3lmy.s[78]++;await add_device_to_default_vessel_when_vessel_deleted(req.params.vessel_id).catch(err=>{cov_fm1fq3lmy.f[20]++;cov_fm1fq3lmy.s[79]++;//Error adding devices to default vessel
throw error_message("reassign device",err.message);});//console.log("Vessel deleted parameter set high in database. Vessel ID: " + req.params.vessel_id);
cov_fm1fq3lmy.s[80]++;await DB_VESSEL_DEVICE.delete_given_vessel_id(req.params.vessel_id).catch(err=>{cov_fm1fq3lmy.f[21]++;cov_fm1fq3lmy.s[81]++;//Error deleting relationship between device and vessel from database
error_location=1;cov_fm1fq3lmy.s[82]++;throw error.error_message("delete vessel : delete device vessel relationship: database",err.message);});//console.log("Device vessel relationship deleted parameter set high in database. Vessel ID: " + req.params.vessel_id);
cov_fm1fq3lmy.s[83]++;vessels_db=await DB.get_vessels_not_deleted().catch(err=>{cov_fm1fq3lmy.f[22]++;cov_fm1fq3lmy.s[84]++;//error getting vessel on db
error_location=2;cov_fm1fq3lmy.s[85]++;throw error_message("fetch vessel : database",err.message);});cov_fm1fq3lmy.s[86]++;res.status(200).send({vessels_db:vessels_db,message:'Vessel deleted',type:'success'});}catch(err){cov_fm1fq3lmy.s[87]++;//e_l =0 (problem deleteing vessel)
//e_l =1 (vessel deleted.. failed to delete vessel device relationship)
//e_l =2 (vessel deleted.. failed to fetch vessels)
//other = (unknown error/exception)
console.log(err);cov_fm1fq3lmy.s[88]++;if(error_location==0){cov_fm1fq3lmy.b[11][0]++;cov_fm1fq3lmy.s[89]++;res.status(500).send({message:"Failed to delete vessel",type:'error'});}else{cov_fm1fq3lmy.b[11][1]++;cov_fm1fq3lmy.s[90]++;if(error_location==1){cov_fm1fq3lmy.b[12][0]++;cov_fm1fq3lmy.s[91]++;res.status(500).send({message:"Vessel deleted. Failed to delete relationship between vessel and deivce",type:'info'});}else{cov_fm1fq3lmy.b[12][1]++;cov_fm1fq3lmy.s[92]++;if(error_location==2){cov_fm1fq3lmy.b[13][0]++;cov_fm1fq3lmy.s[93]++;res.status(500).send({message:"Vessel deleted. Failed to fetch vessels",type:'info'});}else{cov_fm1fq3lmy.b[13][1]++;cov_fm1fq3lmy.s[94]++;res.status(500).send({message:'Error',type:'error'});}}}}},delete_vessel_given_sub_network_id:async function(sub_network_id){cov_fm1fq3lmy.f[23]++;cov_fm1fq3lmy.s[95]++;try{let vessels=(cov_fm1fq3lmy.s[96]++,await DB.get_vessels_filter_sub_network(sub_network_id).catch(err=>{cov_fm1fq3lmy.f[24]++;cov_fm1fq3lmy.s[97]++;//Error fetcing vessels belonging to a particular subnetwork
throw error_message("get vessels under specified sub_network : database",err.message);}));cov_fm1fq3lmy.s[98]++;for(let i=0;i<vessels.length;i++){cov_fm1fq3lmy.s[99]++;await DB_VESSEL_DEVICE.delete_given_vessel_id(vessels[i].id).catch(err=>{cov_fm1fq3lmy.f[25]++;cov_fm1fq3lmy.s[100]++;//Error deleting vessel device realtionship for a given vessel
throw error_message("delete device vessel relationship: database",err.message);});cov_fm1fq3lmy.s[101]++;await DB.delete_vessel(vessels[i].id).catch(err=>{cov_fm1fq3lmy.f[26]++;cov_fm1fq3lmy.s[102]++;//Error deleting vessel from database
throw error_message("database",err.message);});}}catch(err){cov_fm1fq3lmy.s[103]++;console.log(err);cov_fm1fq3lmy.s[104]++;throw err;}}};