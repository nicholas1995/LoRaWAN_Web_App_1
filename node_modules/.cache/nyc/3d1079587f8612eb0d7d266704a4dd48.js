var cov_1pdozpzhhj=function(){var path="/Users/nicholasmitchell/LoRaWAN_Web_App_1/server/src/services/MQTT.js",hash="7750156c1cbbab6598c8c4b1653bf7ad5f18151b",Function=function(){}.constructor,global=new Function('return this')(),gcv="__coverage__",coverageData={path:"/Users/nicholasmitchell/LoRaWAN_Web_App_1/server/src/services/MQTT.js",statementMap:{"0":{start:{line:1,column:13},end:{line:1,column:28}},"1":{start:{line:4,column:15},end:{line:4,column:50}},"2":{start:{line:6,column:25},end:{line:6,column:63}},"3":{start:{line:7,column:19},end:{line:7,column:51}},"4":{start:{line:8,column:18},end:{line:8,column:52}},"5":{start:{line:9,column:22},end:{line:9,column:65}},"6":{start:{line:10,column:21},end:{line:10,column:47}},"7":{start:{line:11,column:19},end:{line:11,column:52}},"8":{start:{line:15,column:0},end:{line:22,column:3}},"9":{start:{line:16,column:4},end:{line:18,column:7}},"10":{start:{line:17,column:8},end:{line:17,column:54}},"11":{start:{line:19,column:4},end:{line:21,column:7}},"12":{start:{line:20,column:6},end:{line:20,column:48}},"13":{start:{line:24,column:0},end:{line:109,column:2}},"14":{start:{line:25,column:4},end:{line:107,column:5}},"15":{start:{line:28,column:8},end:{line:28,column:38}},"16":{start:{line:29,column:32},end:{line:29,column:64}},"17":{start:{line:30,column:8},end:{line:104,column:9}},"18":{start:{line:31,column:23},end:{line:36,column:18}},"19":{start:{line:34,column:20},end:{line:34,column:67}},"20":{start:{line:35,column:20},end:{line:35,column:36}},"21":{start:{line:37,column:12},end:{line:80,column:13}},"22":{start:{line:38,column:16},end:{line:38,column:57}},"23":{start:{line:39,column:16},end:{line:39,column:57}},"24":{start:{line:40,column:16},end:{line:78,column:17}},"25":{start:{line:41,column:20},end:{line:77,column:21}},"26":{start:{line:43,column:24},end:{line:52,column:25}},"27":{start:{line:44,column:28},end:{line:44,column:135}},"28":{start:{line:45,column:28},end:{line:45,column:136}},"29":{start:{line:46,column:30},end:{line:52,column:25}},"30":{start:{line:47,column:28},end:{line:47,column:143}},"31":{start:{line:48,column:28},end:{line:48,column:144}},"32":{start:{line:49,column:30},end:{line:52,column:25}},"33":{start:{line:50,column:28},end:{line:50,column:143}},"34":{start:{line:51,column:28},end:{line:51,column:144}},"35":{start:{line:54,column:24},end:{line:54,column:95}},"36":{start:{line:55,column:24},end:{line:59,column:30}},"37":{start:{line:58,column:32},end:{line:58,column:49}},"38":{start:{line:60,column:24},end:{line:64,column:31}},"39":{start:{line:61,column:32},end:{line:63,column:33}},"40":{start:{line:62,column:36},end:{line:62,column:52}},"41":{start:{line:66,column:24},end:{line:71,column:26}},"42":{start:{line:69,column:28},end:{line:69,column:45}},"43":{start:{line:72,column:24},end:{line:76,column:27}},"44":{start:{line:73,column:28},end:{line:75,column:29}},"45":{start:{line:74,column:32},end:{line:74,column:48}},"46":{start:{line:81,column:14},end:{line:104,column:9}},"47":{start:{line:82,column:38},end:{line:86,column:18}},"48":{start:{line:85,column:20},end:{line:85,column:36}},"49":{start:{line:87,column:12},end:{line:103,column:13}},"50":{start:{line:88,column:16},end:{line:102,column:17}},"51":{start:{line:89,column:20},end:{line:89,column:49}},"52":{start:{line:90,column:20},end:{line:90,column:78}},"53":{start:{line:91,column:20},end:{line:91,column:83}},"54":{start:{line:92,column:20},end:{line:92,column:82}},"55":{start:{line:93,column:20},end:{line:93,column:78}},"56":{start:{line:94,column:20},end:{line:98,column:26}},"57":{start:{line:97,column:28},end:{line:97,column:44}},"58":{start:{line:106,column:8},end:{line:106,column:24}},"59":{start:{line:112,column:4},end:{line:157,column:5}},"60":{start:{line:114,column:8},end:{line:153,column:9}},"61":{start:{line:115,column:12},end:{line:133,column:13}},"62":{start:{line:116,column:37},end:{line:116,column:66}},"63":{start:{line:117,column:33},end:{line:117,column:58}},"64":{start:{line:118,column:16},end:{line:118,column:104}},"65":{start:{line:119,column:19},end:{line:133,column:13}},"66":{start:{line:120,column:37},end:{line:120,column:66}},"67":{start:{line:121,column:33},end:{line:121,column:58}},"68":{start:{line:122,column:16},end:{line:122,column:108}},"69":{start:{line:123,column:19},end:{line:133,column:13}},"70":{start:{line:124,column:37},end:{line:124,column:66}},"71":{start:{line:125,column:33},end:{line:125,column:58}},"72":{start:{line:126,column:16},end:{line:126,column:105}},"73":{start:{line:127,column:19},end:{line:133,column:13}},"74":{start:{line:128,column:37},end:{line:128,column:66}},"75":{start:{line:129,column:33},end:{line:129,column:58}},"76":{start:{line:130,column:16},end:{line:130,column:107}},"77":{start:{line:132,column:16},end:{line:132,column:34}},"78":{start:{line:134,column:15},end:{line:153,column:9}},"79":{start:{line:135,column:12},end:{line:152,column:13}},"80":{start:{line:136,column:38},end:{line:136,column:68}},"81":{start:{line:137,column:16},end:{line:137,column:82}},"82":{start:{line:138,column:19},end:{line:152,column:13}},"83":{start:{line:139,column:38},end:{line:139,column:68}},"84":{start:{line:140,column:16},end:{line:140,column:82}},"85":{start:{line:141,column:19},end:{line:152,column:13}},"86":{start:{line:142,column:38},end:{line:142,column:68}},"87":{start:{line:143,column:16},end:{line:143,column:85}},"88":{start:{line:144,column:19},end:{line:152,column:13}},"89":{start:{line:145,column:38},end:{line:145,column:68}},"90":{start:{line:146,column:16},end:{line:146,column:83}},"91":{start:{line:147,column:19},end:{line:152,column:13}},"92":{start:{line:148,column:38},end:{line:148,column:68}},"93":{start:{line:149,column:16},end:{line:149,column:86}},"94":{start:{line:151,column:16},end:{line:151,column:26}},"95":{start:{line:156,column:8},end:{line:156,column:26}},"96":{start:{line:161,column:16},end:{line:161,column:38}},"97":{start:{line:162,column:16},end:{line:162,column:41}},"98":{start:{line:163,column:4},end:{line:163,column:46}},"99":{start:{line:166,column:16},end:{line:166,column:38}},"100":{start:{line:167,column:16},end:{line:167,column:41}},"101":{start:{line:168,column:4},end:{line:168,column:37}},"102":{start:{line:171,column:16},end:{line:171,column:38}},"103":{start:{line:172,column:16},end:{line:172,column:45}},"104":{start:{line:173,column:16},end:{line:173,column:41}},"105":{start:{line:174,column:4},end:{line:174,column:50}}},fnMap:{"0":{name:"(anonymous_0)",decl:{start:{line:15,column:21},end:{line:15,column:22}},loc:{start:{line:15,column:27},end:{line:22,column:1}},line:15},"1":{name:"(anonymous_1)",decl:{start:{line:16,column:38},end:{line:16,column:39}},loc:{start:{line:16,column:44},end:{line:18,column:5}},line:16},"2":{name:"(anonymous_2)",decl:{start:{line:19,column:34},end:{line:19,column:35}},loc:{start:{line:19,column:40},end:{line:21,column:5}},line:19},"3":{name:"(anonymous_3)",decl:{start:{line:24,column:21},end:{line:24,column:22}},loc:{start:{line:24,column:53},end:{line:109,column:1}},line:24},"4":{name:"(anonymous_4)",decl:{start:{line:32,column:23},end:{line:32,column:24}},loc:{start:{line:32,column:30},end:{line:36,column:17}},line:32},"5":{name:"(anonymous_5)",decl:{start:{line:56,column:35},end:{line:56,column:36}},loc:{start:{line:56,column:42},end:{line:59,column:29}},line:56},"6":{name:"(anonymous_6)",decl:{start:{line:60,column:65},end:{line:60,column:66}},loc:{start:{line:60,column:78},end:{line:64,column:29}},line:60},"7":{name:"(anonymous_7)",decl:{start:{line:67,column:24},end:{line:67,column:25}},loc:{start:{line:67,column:31},end:{line:70,column:25}},line:67},"8":{name:"(anonymous_8)",decl:{start:{line:72,column:65},end:{line:72,column:66}},loc:{start:{line:72,column:78},end:{line:76,column:25}},line:72},"9":{name:"(anonymous_9)",decl:{start:{line:83,column:23},end:{line:83,column:24}},loc:{start:{line:83,column:30},end:{line:86,column:17}},line:83},"10":{name:"(anonymous_10)",decl:{start:{line:95,column:31},end:{line:95,column:32}},loc:{start:{line:95,column:38},end:{line:98,column:25}},line:95},"11":{name:"extract_topic_information",decl:{start:{line:111,column:9},end:{line:111,column:34}},loc:{start:{line:111,column:41},end:{line:158,column:1}},line:111},"12":{name:"extract_application_id",decl:{start:{line:160,column:9},end:{line:160,column:31}},loc:{start:{line:160,column:38},end:{line:164,column:1}},line:160},"13":{name:"extract_gateway_id_lora",decl:{start:{line:165,column:9},end:{line:165,column:32}},loc:{start:{line:165,column:39},end:{line:169,column:1}},line:165},"14":{name:"extract_device_eui",decl:{start:{line:170,column:9},end:{line:170,column:27}},loc:{start:{line:170,column:35},end:{line:175,column:1}},line:170}},branchMap:{"0":{loc:{start:{line:30,column:8},end:{line:104,column:9}},type:"if",locations:[{start:{line:30,column:8},end:{line:104,column:9}},{start:{line:30,column:8},end:{line:104,column:9}}],line:30},"1":{loc:{start:{line:37,column:12},end:{line:80,column:13}},type:"if",locations:[{start:{line:37,column:12},end:{line:80,column:13}},{start:{line:37,column:12},end:{line:80,column:13}}],line:37},"2":{loc:{start:{line:40,column:16},end:{line:78,column:17}},type:"if",locations:[{start:{line:40,column:16},end:{line:78,column:17}},{start:{line:40,column:16},end:{line:78,column:17}}],line:40},"3":{loc:{start:{line:41,column:20},end:{line:77,column:21}},type:"if",locations:[{start:{line:41,column:20},end:{line:77,column:21}},{start:{line:41,column:20},end:{line:77,column:21}}],line:41},"4":{loc:{start:{line:43,column:24},end:{line:52,column:25}},type:"if",locations:[{start:{line:43,column:24},end:{line:52,column:25}},{start:{line:43,column:24},end:{line:52,column:25}}],line:43},"5":{loc:{start:{line:46,column:30},end:{line:52,column:25}},type:"if",locations:[{start:{line:46,column:30},end:{line:52,column:25}},{start:{line:46,column:30},end:{line:52,column:25}}],line:46},"6":{loc:{start:{line:49,column:30},end:{line:52,column:25}},type:"if",locations:[{start:{line:49,column:30},end:{line:52,column:25}},{start:{line:49,column:30},end:{line:52,column:25}}],line:49},"7":{loc:{start:{line:61,column:32},end:{line:63,column:33}},type:"if",locations:[{start:{line:61,column:32},end:{line:63,column:33}},{start:{line:61,column:32},end:{line:63,column:33}}],line:61},"8":{loc:{start:{line:73,column:28},end:{line:75,column:29}},type:"if",locations:[{start:{line:73,column:28},end:{line:75,column:29}},{start:{line:73,column:28},end:{line:75,column:29}}],line:73},"9":{loc:{start:{line:81,column:14},end:{line:104,column:9}},type:"if",locations:[{start:{line:81,column:14},end:{line:104,column:9}},{start:{line:81,column:14},end:{line:104,column:9}}],line:81},"10":{loc:{start:{line:87,column:12},end:{line:103,column:13}},type:"if",locations:[{start:{line:87,column:12},end:{line:103,column:13}},{start:{line:87,column:12},end:{line:103,column:13}}],line:87},"11":{loc:{start:{line:88,column:16},end:{line:102,column:17}},type:"if",locations:[{start:{line:88,column:16},end:{line:102,column:17}},{start:{line:88,column:16},end:{line:102,column:17}}],line:88},"12":{loc:{start:{line:114,column:8},end:{line:153,column:9}},type:"if",locations:[{start:{line:114,column:8},end:{line:153,column:9}},{start:{line:114,column:8},end:{line:153,column:9}}],line:114},"13":{loc:{start:{line:115,column:12},end:{line:133,column:13}},type:"if",locations:[{start:{line:115,column:12},end:{line:133,column:13}},{start:{line:115,column:12},end:{line:133,column:13}}],line:115},"14":{loc:{start:{line:119,column:19},end:{line:133,column:13}},type:"if",locations:[{start:{line:119,column:19},end:{line:133,column:13}},{start:{line:119,column:19},end:{line:133,column:13}}],line:119},"15":{loc:{start:{line:123,column:19},end:{line:133,column:13}},type:"if",locations:[{start:{line:123,column:19},end:{line:133,column:13}},{start:{line:123,column:19},end:{line:133,column:13}}],line:123},"16":{loc:{start:{line:127,column:19},end:{line:133,column:13}},type:"if",locations:[{start:{line:127,column:19},end:{line:133,column:13}},{start:{line:127,column:19},end:{line:133,column:13}}],line:127},"17":{loc:{start:{line:134,column:15},end:{line:153,column:9}},type:"if",locations:[{start:{line:134,column:15},end:{line:153,column:9}},{start:{line:134,column:15},end:{line:153,column:9}}],line:134},"18":{loc:{start:{line:135,column:12},end:{line:152,column:13}},type:"if",locations:[{start:{line:135,column:12},end:{line:152,column:13}},{start:{line:135,column:12},end:{line:152,column:13}}],line:135},"19":{loc:{start:{line:138,column:19},end:{line:152,column:13}},type:"if",locations:[{start:{line:138,column:19},end:{line:152,column:13}},{start:{line:138,column:19},end:{line:152,column:13}}],line:138},"20":{loc:{start:{line:141,column:19},end:{line:152,column:13}},type:"if",locations:[{start:{line:141,column:19},end:{line:152,column:13}},{start:{line:141,column:19},end:{line:152,column:13}}],line:141},"21":{loc:{start:{line:144,column:19},end:{line:152,column:13}},type:"if",locations:[{start:{line:144,column:19},end:{line:152,column:13}},{start:{line:144,column:19},end:{line:152,column:13}}],line:144},"22":{loc:{start:{line:147,column:19},end:{line:152,column:13}},type:"if",locations:[{start:{line:147,column:19},end:{line:152,column:13}},{start:{line:147,column:19},end:{line:152,column:13}}],line:147}},s:{"0":0,"1":0,"2":0,"3":0,"4":0,"5":0,"6":0,"7":0,"8":0,"9":0,"10":0,"11":0,"12":0,"13":0,"14":0,"15":0,"16":0,"17":0,"18":0,"19":0,"20":0,"21":0,"22":0,"23":0,"24":0,"25":0,"26":0,"27":0,"28":0,"29":0,"30":0,"31":0,"32":0,"33":0,"34":0,"35":0,"36":0,"37":0,"38":0,"39":0,"40":0,"41":0,"42":0,"43":0,"44":0,"45":0,"46":0,"47":0,"48":0,"49":0,"50":0,"51":0,"52":0,"53":0,"54":0,"55":0,"56":0,"57":0,"58":0,"59":0,"60":0,"61":0,"62":0,"63":0,"64":0,"65":0,"66":0,"67":0,"68":0,"69":0,"70":0,"71":0,"72":0,"73":0,"74":0,"75":0,"76":0,"77":0,"78":0,"79":0,"80":0,"81":0,"82":0,"83":0,"84":0,"85":0,"86":0,"87":0,"88":0,"89":0,"90":0,"91":0,"92":0,"93":0,"94":0,"95":0,"96":0,"97":0,"98":0,"99":0,"100":0,"101":0,"102":0,"103":0,"104":0,"105":0},f:{"0":0,"1":0,"2":0,"3":0,"4":0,"5":0,"6":0,"7":0,"8":0,"9":0,"10":0,"11":0,"12":0,"13":0,"14":0},b:{"0":[0,0],"1":[0,0],"2":[0,0],"3":[0,0],"4":[0,0],"5":[0,0],"6":[0,0],"7":[0,0],"8":[0,0],"9":[0,0],"10":[0,0],"11":[0,0],"12":[0,0],"13":[0,0],"14":[0,0],"15":[0,0],"16":[0,0],"17":[0,0],"18":[0,0],"19":[0,0],"20":[0,0],"21":[0,0],"22":[0,0]},_coverageSchema:"43e27e138ebf9cfc5966b082cf9a028302ed4184"},coverage=global[gcv]||(global[gcv]={});if(coverage[path]&&coverage[path].hash===hash){return coverage[path];}coverageData.hash=hash;return coverage[path]=coverageData;}();const mqtt=(cov_1pdozpzhhj.s[0]++,require("mqtt"));// to be changed to own local server/service
//const client = mqtt.connect("mqtt:broker.mqttdashboard.com"); //TO TEST USING HIVEMQ
const client=(cov_1pdozpzhhj.s[1]++,mqtt.connect("mqtt:localhost:1883"));const VESSEL_DEVICE_DB=(cov_1pdozpzhhj.s[2]++,require("./database/vessel_device_db"));const GATEWAY_DB=(cov_1pdozpzhhj.s[3]++,require("./database/gateway_db"));const DEVICE_RX=(cov_1pdozpzhhj.s[4]++,require("./database/device_rx_db"));const GATEWAY_STATS=(cov_1pdozpzhhj.s[5]++,require("./database/gateway_statistics_db"));const DB_SECONDARY=(cov_1pdozpzhhj.s[6]++,require("../db_secondary"));const simulation=(cov_1pdozpzhhj.s[7]++,require("./sample_device_tracks"));//    application/123/device/1111111111111111/rx (topic example)
//    gateway/2222222222222222/stats
cov_1pdozpzhhj.s[8]++;client.on('connect',()=>{cov_1pdozpzhhj.f[0]++;cov_1pdozpzhhj.s[9]++;client.subscribe("application/#",()=>{cov_1pdozpzhhj.f[1]++;cov_1pdozpzhhj.s[10]++;console.log("subscribed to all applications");});cov_1pdozpzhhj.s[11]++;client.subscribe("gateway/#",()=>{cov_1pdozpzhhj.f[2]++;cov_1pdozpzhhj.s[12]++;console.log("subscribed to all gateways");});});cov_1pdozpzhhj.s[13]++;client.on('message',async function(topic,message){cov_1pdozpzhhj.f[3]++;cov_1pdozpzhhj.s[14]++;try{cov_1pdozpzhhj.s[15]++;// message is Buffer
//message = message.toString()  //TO TEST USING HIVEMQ
message=JSON.parse(message);let topic_information=(cov_1pdozpzhhj.s[16]++,extract_topic_information(topic));cov_1pdozpzhhj.s[17]++;if(topic_information.type==0){cov_1pdozpzhhj.b[0][0]++;//device
let data=(cov_1pdozpzhhj.s[18]++,await VESSEL_DEVICE_DB.return_vessel_id_device_id(topic_information.device_eui).catch(err=>{cov_1pdozpzhhj.f[4]++;cov_1pdozpzhhj.s[19]++;//Error fetching device information from db
console.log('error MQTT fetch vessels from db');cov_1pdozpzhhj.s[20]++;console.log(err);}));cov_1pdozpzhhj.s[21]++;if(data[0]){cov_1pdozpzhhj.b[1][0]++;cov_1pdozpzhhj.s[22]++;//if device is assocaited with a gateway
message["vessel_id"]=data[0].vessel_id;cov_1pdozpzhhj.s[23]++;message["device_id"]=data[0].device_id;cov_1pdozpzhhj.s[24]++;if(topic_information.event=='rx'){cov_1pdozpzhhj.b[2][0]++;cov_1pdozpzhhj.s[25]++;if(message.rxInfo){cov_1pdozpzhhj.b[3][0]++;cov_1pdozpzhhj.s[26]++;//--------THIS IS JUST FOR THE SIMILATION
if(message.rxInfo[0].rssi==1){cov_1pdozpzhhj.b[4][0]++;cov_1pdozpzhhj.s[27]++;//Trinidad north west
message.object.gpsLocation["1"]["latitude"]=parseFloat(simulation.track_1[message.txInfo.frequency].lat);cov_1pdozpzhhj.s[28]++;message.object.gpsLocation["1"]["longitude"]=parseFloat(simulation.track_1[message.txInfo.frequency].lng);}else{cov_1pdozpzhhj.b[4][1]++;cov_1pdozpzhhj.s[29]++;if(message.rxInfo[0].rssi==2){cov_1pdozpzhhj.b[5][0]++;cov_1pdozpzhhj.s[30]++;//Tobago north west
message.object.gpsLocation["1"]["latitude"]=parseFloat(simulation.tobago_tracks_1[message.txInfo.frequency].lat);cov_1pdozpzhhj.s[31]++;message.object.gpsLocation["1"]["longitude"]=parseFloat(simulation.tobago_tracks_1[message.txInfo.frequency].lng);}else{cov_1pdozpzhhj.b[5][1]++;cov_1pdozpzhhj.s[32]++;if(message.rxInfo[0].rssi==3){cov_1pdozpzhhj.b[6][0]++;cov_1pdozpzhhj.s[33]++;//Grenada
message.object.gpsLocation["1"]["latitude"]=parseFloat(simulation.grenada_track_1[message.txInfo.frequency].lat);cov_1pdozpzhhj.s[34]++;message.object.gpsLocation["1"]["longitude"]=parseFloat(simulation.grenada_track_1[message.txInfo.frequency].lng);}else{cov_1pdozpzhhj.b[6][1]++;}}}cov_1pdozpzhhj.s[35]++;message.object.temperatureSensor["3"]=simulation.random_temperatue();cov_1pdozpzhhj.s[36]++;await DEVICE_RX.create(message).catch(err=>{cov_1pdozpzhhj.f[5]++;cov_1pdozpzhhj.s[37]++;//Error adding rx device data to the database
console.log(err);});cov_1pdozpzhhj.s[38]++;DB_SECONDARY.device_uplink.save(message,function(err){cov_1pdozpzhhj.f[6]++;cov_1pdozpzhhj.s[39]++;if(err){cov_1pdozpzhhj.b[7][0]++;cov_1pdozpzhhj.s[40]++;console.log(err);}else{cov_1pdozpzhhj.b[7][1]++;}});}else{cov_1pdozpzhhj.b[3][1]++;cov_1pdozpzhhj.s[41]++;await DEVICE_RX.create_no_rxInfo(message).catch(err=>{cov_1pdozpzhhj.f[7]++;cov_1pdozpzhhj.s[42]++;//Error adding rx device data to the database
console.log(err);});cov_1pdozpzhhj.s[43]++;DB_SECONDARY.device_uplink.save(message,function(err){cov_1pdozpzhhj.f[8]++;cov_1pdozpzhhj.s[44]++;if(err){cov_1pdozpzhhj.b[8][0]++;cov_1pdozpzhhj.s[45]++;console.log(err);}else{cov_1pdozpzhhj.b[8][1]++;}});}}else{cov_1pdozpzhhj.b[2][1]++;}}else{cov_1pdozpzhhj.b[1][1]++;}}else{cov_1pdozpzhhj.b[0][1]++;cov_1pdozpzhhj.s[46]++;if(topic_information.type==1){cov_1pdozpzhhj.b[9][0]++;//gateway
let gateway_information=(cov_1pdozpzhhj.s[47]++,await GATEWAY_DB.get_gateway_specified(topic_information.gateway_id_lora).catch(err=>{cov_1pdozpzhhj.f[9]++;cov_1pdozpzhhj.s[48]++;//Error fetching specific gateway from database
console.log(err);}));cov_1pdozpzhhj.s[49]++;if(gateway_information[0]){cov_1pdozpzhhj.b[10][0]++;cov_1pdozpzhhj.s[50]++;if(topic_information.event=='stats'){cov_1pdozpzhhj.b[11][0]++;cov_1pdozpzhhj.s[51]++;message=JSON.parse(message);cov_1pdozpzhhj.s[52]++;message['gateway_id']=gateway_information[0].gateway_id;cov_1pdozpzhhj.s[53]++;message['gateway_id_lora']=topic_information.gateway_id_lora;cov_1pdozpzhhj.s[54]++;message['gateway_name']=gateway_information[0].gateway_name;cov_1pdozpzhhj.s[55]++;message['network_id']=gateway_information[0].network_id;cov_1pdozpzhhj.s[56]++;await GATEWAY_STATS.create_gateway_statistics(message).catch(err=>{cov_1pdozpzhhj.f[10]++;cov_1pdozpzhhj.s[57]++;//Error creating gateway stat record
console.log(err);});}else{//gateway message other than stats
cov_1pdozpzhhj.b[11][1]++;}}else{cov_1pdozpzhhj.b[10][1]++;}}else{cov_1pdozpzhhj.b[9][1]++;}}}catch(err){cov_1pdozpzhhj.s[58]++;console.log(err);}});function extract_topic_information(topic){cov_1pdozpzhhj.f[11]++;cov_1pdozpzhhj.s[59]++;try{cov_1pdozpzhhj.s[60]++;//Type 0 is used for device events, type 1 is used for gateway events
if(topic.search('application')!=-1){cov_1pdozpzhhj.b[12][0]++;cov_1pdozpzhhj.s[61]++;//Received messeage contains application information
if(topic.search('rx')!=-1){cov_1pdozpzhhj.b[13][0]++;let sub_network_id=(cov_1pdozpzhhj.s[62]++,extract_application_id(topic));let device_eui=(cov_1pdozpzhhj.s[63]++,extract_device_eui(topic));cov_1pdozpzhhj.s[64]++;return{type:0,sub_network_id:sub_network_id,device_eui:device_eui,event:"rx"};}else{cov_1pdozpzhhj.b[13][1]++;cov_1pdozpzhhj.s[65]++;if(topic.search('status')!=-1){cov_1pdozpzhhj.b[14][0]++;let sub_network_id=(cov_1pdozpzhhj.s[66]++,extract_application_id(topic));let device_eui=(cov_1pdozpzhhj.s[67]++,extract_device_eui(topic));cov_1pdozpzhhj.s[68]++;return{type:0,sub_network_id:sub_network_id,device_eui:device_eui,event:"status"};}else{cov_1pdozpzhhj.b[14][1]++;cov_1pdozpzhhj.s[69]++;if(topic.search('ack')!=-1){cov_1pdozpzhhj.b[15][0]++;let sub_network_id=(cov_1pdozpzhhj.s[70]++,extract_application_id(topic));let device_eui=(cov_1pdozpzhhj.s[71]++,extract_device_eui(topic));cov_1pdozpzhhj.s[72]++;return{type:0,sub_network_id:sub_network_id,device_eui:device_eui,event:"ack"};}else{cov_1pdozpzhhj.b[15][1]++;cov_1pdozpzhhj.s[73]++;if(topic.search('error')!=-1){cov_1pdozpzhhj.b[16][0]++;let sub_network_id=(cov_1pdozpzhhj.s[74]++,extract_application_id(topic));let device_eui=(cov_1pdozpzhhj.s[75]++,extract_device_eui(topic));cov_1pdozpzhhj.s[76]++;return{type:0,sub_network_id:sub_network_id,device_eui:device_eui,event:"error"};}else{cov_1pdozpzhhj.b[16][1]++;cov_1pdozpzhhj.s[77]++;return{type:2};}}}}}else{cov_1pdozpzhhj.b[12][1]++;cov_1pdozpzhhj.s[78]++;if(topic.search("gateway")!=-1){cov_1pdozpzhhj.b[17][0]++;cov_1pdozpzhhj.s[79]++;//Received message contains gateway information
if(topic.search('rx')!=-1){cov_1pdozpzhhj.b[18][0]++;let gateway_id_lora=(cov_1pdozpzhhj.s[80]++,extract_gateway_id_lora(topic));cov_1pdozpzhhj.s[81]++;return{type:1,gateway_id_lora:gateway_id_lora,event:"rx"};}else{cov_1pdozpzhhj.b[18][1]++;cov_1pdozpzhhj.s[82]++;if(topic.search('tx')!=-1){cov_1pdozpzhhj.b[19][0]++;let gateway_id_lora=(cov_1pdozpzhhj.s[83]++,extract_gateway_id_lora(topic));cov_1pdozpzhhj.s[84]++;return{type:1,gateway_id_lora:gateway_id_lora,event:"tx"};}else{cov_1pdozpzhhj.b[19][1]++;cov_1pdozpzhhj.s[85]++;if(topic.search('stats')!=-1){cov_1pdozpzhhj.b[20][0]++;let gateway_id_lora=(cov_1pdozpzhhj.s[86]++,extract_gateway_id_lora(topic));cov_1pdozpzhhj.s[87]++;return{type:1,gateway_id_lora:gateway_id_lora,event:"stats"};}else{cov_1pdozpzhhj.b[20][1]++;cov_1pdozpzhhj.s[88]++;if(topic.search('ack')!=-1){cov_1pdozpzhhj.b[21][0]++;let gateway_id_lora=(cov_1pdozpzhhj.s[89]++,extract_gateway_id_lora(topic));cov_1pdozpzhhj.s[90]++;return{type:1,gateway_id_lora:gateway_id_lora,event:"ack"};}else{cov_1pdozpzhhj.b[21][1]++;cov_1pdozpzhhj.s[91]++;if(topic.search('config')!=-1){cov_1pdozpzhhj.b[22][0]++;let gateway_id_lora=(cov_1pdozpzhhj.s[92]++,extract_gateway_id_lora(topic));cov_1pdozpzhhj.s[93]++;return{type:1,gateway_id_lora:gateway_id_lora,event:"config"};}else{cov_1pdozpzhhj.b[22][1]++;cov_1pdozpzhhj.s[94]++;throw err;}}}}}}else{cov_1pdozpzhhj.b[17][1]++;}}}catch(err){cov_1pdozpzhhj.s[95]++;//Unknown messgae
return{type:2};}}function extract_application_id(topic){cov_1pdozpzhhj.f[12]++;let pos_1=(cov_1pdozpzhhj.s[96]++,topic.indexOf('/')+1);let pos_2=(cov_1pdozpzhhj.s[97]++,topic.indexOf('/',pos_1));cov_1pdozpzhhj.s[98]++;return app_id=topic.slice(pos_1,pos_2);}function extract_gateway_id_lora(topic){cov_1pdozpzhhj.f[13]++;let pos_1=(cov_1pdozpzhhj.s[99]++,topic.indexOf('/')+1);let pos_2=(cov_1pdozpzhhj.s[100]++,topic.indexOf('/',pos_1));cov_1pdozpzhhj.s[101]++;return topic.slice(pos_1,pos_2);}function extract_device_eui(topic){cov_1pdozpzhhj.f[14]++;let pos_1=(cov_1pdozpzhhj.s[102]++,topic.search("device"));let pos_2=(cov_1pdozpzhhj.s[103]++,topic.indexOf('/',pos_1)+1);let pos_3=(cov_1pdozpzhhj.s[104]++,topic.indexOf('/',pos_2));cov_1pdozpzhhj.s[105]++;return device_eui=topic.slice(pos_2,pos_3);}